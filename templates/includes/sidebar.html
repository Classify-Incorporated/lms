{% load static %}
{% load permissions %}

<!-- Main Sidebar Container -->
<aside class="main-sidebar custom-sidebar elevation-4 sidebar-no-expand sidebar-light-success">
  <!-- Brand Logo -->
  <a href="{% url 'dashboard' %}" class="brand-link" style="display: flex; align-items: center;">
    <img src="{% static 'assets/dist/images/gsu_logo.png' %}" alt="AdminLTE Logo" class="brand-image img-circle elevation-3" />
    <span class="brand-text font-weight-bold">GUIMARAS STATE UNIVERSITY</span>
  </a>

  <!-- Sidebar -->
  <div class="sidebar">
    <div class="user-panel mt-3 pb-3 mb-3 d-flex">
      <div class="image">
        <img src="{% if request.user.profile.student_photo %}
            {{ request.user.profile.student_photo.url }}
          {% else %}
            {% static 'assets/dist/img/profile_default.png' %}
          {% endif %}"
          alt="User Image"
          class="img-circle elevation-2" />
      </div>
      <div class="info">
        <a href="{% url 'viewProfile' request.user.id %}" class="d-block text-dark">{{ request.user.first_name|title }} {{ request.user.last_name|title }}</a>
      </div>
    </div>

    <div class="form-inline">
      <div class="input-group" data-widget="sidebar-search">
        <input class="form-control form-control-sidebar form-control-sidebar-light bg-light btn-outline-success" type="search" placeholder="Search" aria-label="Search" />
        <div class="input-group-append">
          <button class="btn btn-sidebar bg-success"><i class="bx bx-search"></i></button>
        </div>
      </div>
    </div>

    <!-- Sidebar Menu -->
    <nav class="mt-2">
      <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
        <!-- Dashboard -->
        <li class="nav-item">
          <a href="{% url 'dashboard' %}" class="nav-link d-flex align-items-center">
            <i class="bx bx-home nav-icon mr-2"></i>
            <p>Dashboard</p>
          </a>
        </li>

        {% if not user.is_superuser and not user.is_staff %}
        {% if not user.profile.role.name|lower == 'registrar' %}
        <!-- Calendar -->
        <li class="nav-item">
          <a href="{% url 'calendars' %}" class="nav-link d-flex align-items-center">
            <i class="bx bx-calendar nav-icon mr-2"></i>
            <p>Calendar</p>
          </a>
        </li>
        {% endif %}
        {% endif %}

        {% if not user.is_superuser and not user.is_staff %}
        <!-- Messages (Permission check) -->
        {% if user|has_perm:'message.view_message' %}
          <li class="nav-item">
            <a href="{% url 'inbox' %}" class="nav-link d-flex align-items-center">
              <i class="bx bx-chat nav-icon mr-2"></i>
              <p>Messages</p>
              {% if unread_messages_count > 0 %}
                <span class="badge badge-danger">{{ unread_messages_count }}</span>
              {% endif %}
            </a>
          </li>
        {% endif %}
        {% endif %}

        {% if not user.is_superuser and not user.is_staff %}
        <!-- Teaching Section -->
        <li class="nav-item">
          <a href="#" class="nav-link d-flex align-items-center">
            <i class="bx bx-book-open nav-icon mr-2"></i>
            <p>
              Teaching <i class="bx bx-chevron-down right"></i>
            </p>
          </a>

          <ul class="nav nav-treeview">
            {% if not user.profile.role.name|lower == 'registrar' %}
            {% if user|has_perm:'subject.view_subject' %}
              <li class="nav-item">
                <a href="{% url 'SubjectList' %}" class="nav-link d-flex align-items-center">
                  <i class="bx bx-circle nav-icon mr-2"></i>
                  <p>Subjects</p>
                </a>
              </li>
            {% endif %}
            {% endif %}

            {% if user|has_perm:'gradebookcomponent.view_gradebookcomponents' %}
              <li class="nav-item">
                <a href="{% url 'studentTotalScoreForActivity' %}" class="nav-link d-flex align-items-center">
                  <i class="bx bx-circle nav-icon mr-2"></i>
                  <p>Grades</p>
                </a>
              </li>
            {% endif %}
            
            {% if not user.profile.role.name|lower == 'student' %}
            {% if user|has_perm:'subject.view_subject' %}
              <li class="nav-item">
                <a href="{% url 'subject' %}" class="nav-link d-flex align-items-center">
                  <i class="bx bx-circle nav-icon mr-2"></i>
                  <p>Subject List</p>
                </a>
              </li>
            {% endif %}
            {% endif %}

            {% if not user.profile.role.name|lower == 'registrar' %}
            {% if not user.profile.role.name|lower == 'student' %}
            {% if user|has_perm:'subject.view_subject' %}
              <li class="nav-item">
                <a href="{% url 'progressList' %}" class="nav-link d-flex align-items-center">
                  <i class="bx bx-circle nav-icon mr-2"></i>
                  <p>Activity Progress</p>
                </a>
              </li>
            {% endif %}
            {% endif %}
            {% endif %}
          </ul>
        </li>
        {% endif %}

        {% if not user.is_superuser and not user.is_staff %}
        <!-- Enroll Students -->
        {% if user|has_perm:'course.view_subjectenrollment' %}
          <li class="nav-item">
            <a href="{% url 'subjectEnrollmentList' %}" class="nav-link d-flex align-items-center">
              <i class="bx bx-user-plus nav-icon mr-2"></i>
              <p>Enroll Students</p>
            </a>
          </li>
        {% endif %}
        {% endif %}

        <!-- Settings Section -->
        {% if not user.profile.role.name|lower == 'student' %}
        <li class="nav-item">
          <a href="#" class="nav-link d-flex align-items-center">
            <i class="bx bx-cog nav-icon mr-2"></i>
            <p>
              Settings <i class="bx bx-chevron-down right"></i>
            </p>
          </a>
          <ul class="nav nav-treeview">
            {% if user|has_perm:'roles.view_role' %}
              <li class="nav-item">
                <a href="{% url 'roleList' %}" class="nav-link d-flex align-items-center">
                  <i class="bx bx-circle nav-icon mr-2"></i>
                  <p>Role</p>
                </a>
              </li>
            {% endif %}

            {% if not user.is_superuser and not user.is_staff %}
            {% if user|has_perm:'course.view_semester' %}
              <li class="nav-item">
                <a href="{% url 'activityTypeList' %}" class="nav-link d-flex align-items-center">
                  <i class="bx bx-circle nav-icon mr-2"></i>
                  <p>Activity Type</p>
                </a>
              </li>
            {% endif %}
            {% endif %}

            {% if not user.is_superuser and not user.is_staff %}
            {% if user|has_perm:'course.view_semester' %}
              <li class="nav-item">
                <a href="{% url 'semesterList' %}" class="nav-link d-flex align-items-center">
                  <i class="bx bx-circle nav-icon mr-2"></i>
                  <p>Semester</p>
                </a>
              </li>
            {% endif %}
            {% endif %}

            {% if not user.is_superuser and not user.is_staff %}
            {% if user|has_perm:'subject.view_subject' %}
            {% if user.profile.role.name|lower == 'teacher' %}
              <li class="nav-item">
                <a href="{% url 'viewGradeBookComponents' %}" class="nav-link d-flex align-items-center">
                  <i class="bx bx-circle nav-icon mr-2"></i>
                  <p>Subject Percentage</p>
                </a>
              </li>
            {% endif %}
            {% endif %}
            {% endif %}


            
            {% if user.profile.role.name|lower == 'teacher' %}
            {% if user|has_perm:'subject.view_subject' %}
            {% if not user.is_superuser and not user.is_staff %}
              <li class="nav-item">
                <a href="{% url 'subGradebook' %}" class="nav-link d-flex align-items-center">
                  <i class="bx bx-circle nav-icon mr-2"></i>
                  <p>Subject Sub Percentage</p>
                </a>
              </li>
            {% endif %}
            {% endif %}
            {% endif %}

            {% if not user.is_superuser and not user.is_staff %}
            {% if user|has_perm:'course.view_term' %}
              <li class="nav-item">
                <a href="{% url 'termList' %}" class="nav-link d-flex align-items-center">
                  <i class="bx bx-circle nav-icon mr-2"></i>
                  <p>Term</p>
                </a>
              </li>
            {% endif %}
            {% endif %}
            
            {% if not user.is_superuser and not user.is_staff %}
              {% if user.profile.role.name|lower != 'registrar' %}
                {% if user|has_perm:'subject.view_subject' %}
                  <li class="nav-item">
                    <a href="{% url 'termBookList' %}" class="nav-link d-flex align-items-center">
                      <i class="bx bx-circle nav-icon mr-2"></i>
                      <p>Term Percentage</p>
                    </a>
                  </li>
                {% endif %}
              {% endif %}
            {% endif %}


            {% if user|has_perm:'course.view_semester' %}
            {% if user.profile.role.name|lower == 'admin' or user.is_superuser or user.is_staff %}
              <li class="nav-item">
                <a href="{% url 'student' %}" class="nav-link d-flex align-items-center">
                  <i class="bx bx-circle nav-icon mr-2"></i>
                  <p>Student List</p>
                </a>
              </li>
            {% endif %}
            {% endif %}


            {% if user|has_perm:'course.view_semester' %}
            {% if user.profile.role.name|lower == 'admin' or user.is_superuser or user.is_staff %}
              <li class="nav-item">
                <a href="{% url 'staff_list' %}" class="nav-link d-flex align-items-center">
                  <i class="bx bx-circle nav-icon mr-2"></i>
                  <p>User List</p>
                </a>
              </li>
            {% endif %}
            {% endif %}

            {% endif %}

          </ul>
        </li>
      </ul>
    </nav>
    <!-- /.sidebar-menu -->
  </div>
  <!-- /.sidebar -->
</aside>
