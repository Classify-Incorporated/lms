{% load static %}
{% load permissions %}

<ul class="navbar-nav sidebar custom-sidebar accordion custom-sidebar-fixed" id="accordionSidebar">
  <!-- Sidebar - Brand -->
  <a class="sidebar-brand d-flex align-items-center justify-content-center" href="{% url 'dashboard' %}">
    <div class="sidebar-brand-icon">
      <img src="{% static 'images/gsu_logo.png' %}" alt="Classify Logo" style="width: 50px; height: 50px; border-radius: 50%;" />
    </div>
    <div class="sidebar-brand-text mx-2">Guimaras State University</div>
  </a>

  <!-- Nav Item - Dashboard -->
  <li class="nav-item mt-2 {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
    <a class="nav-link" href="{% url 'dashboard' %}">
      <i class="bx bx-home"></i>
      <span>Dashboard</span>
    </a>
  </li>

  <!-- Profile Section (Permission check) -->
  {% if user|has_perm:'accounts.view_profile' %}
    <li class="nav-item {% if request.resolver_match.url_name == 'viewProfile' %}active{% endif %}">
      <a class="nav-link" href="{% url 'viewProfile' request.user.id %}">
        <i class="bx bx-user"></i>
        <span>{{ request.user.first_name|title }} {{ request.user.last_name|title }}</span>
      </a>
    </li>
  {% endif %}

  <!-- Calendar -->
  {% if user.profile.role.name|lower != 'admin' %}
  <li class="nav-item {% if request.resolver_match.url_name == 'calendars' %}active{% endif %}">
    <a class="nav-link" href="{% url 'calendars' %}">
      <i class="bx bx-calendar"></i>
      <span>Calendar</span>
    </a>
  </li>
  {% endif %}

  <!-- Messages (Permission check) -->
  {% if user|has_perm:'message.view_message' and user.profile.role.name|lower != 'admin' %}
    <li class="nav-item {% if request.resolver_match.url_name == 'inbox' %}active{% endif %}">
      <a class="nav-link" href="{% url 'inbox' %}">
        <i class="bx bx-envelope"></i>
        <span>Messages</span>
        {% if unread_messages_count > 0 %}
          <sup><span class="badge badge-danger">{{ unread_messages_count }}</span></sup>
        {% endif %}
      </a>
    </li>
  {% endif %}

  <!-- Teaching Section --> 
   {% if user.profile.role.name|lower != 'admin' %}
  <li class="nav-item">
    <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo">
      <i class="bx bx-chalkboard"></i>
      <span>Teaching</span>
    </a>
    <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionSidebar">
      <div class="bg-white py-2 collapse-inner rounded">
        {% if user|has_perm:'course.view_course' %}
          <a class="collapse-item" href="{% url 'SubjectList' %}">
            <i class="bx bx-book"></i>
            <span>Subject</span>
          </a>
        {% endif %}
        {% if user|has_perm:'gradebookcomponent.view_gradebookcomponents' %}
          <a class="collapse-item" href="{% url 'studentTotalScoreForActivity' %}">
            <i class="bx bx-clipboard"></i>
            <span>Grades</span>
          </a>
        {% endif %}
        {% if user|has_perm:'subject.view_subject' %}
          <a class="collapse-item" href="{% url 'subject' %}">
            <i class="bx bx-book"></i>
            <span>Subject List</span>
          </a>
        {% endif %}
        {% if user|has_perm:'activity.view_activity' and user.profile.role.name|lower != 'admin' %}
          <a class="collapse-item" href="{% url 'progressList' %}">
            <i class="bx bx-bar-chart"></i>
            <span>Activity Progress</span>
          </a>
        {% endif %}

        <a class="collapse-item" href="{% url 'previousSemestersView' %}">
          <i class="bx bx-clipboard"></i>
          <span>Archived Semester</span>
        </a>
      </div>
    </div>
  </li>
  {% endif %}

  <!-- Enroll Students (Permission check) -->
  {% if user|has_perm:'course.view_subjectenrollment' and user.profile.role.name|lower != 'admin' %}
    <li class="nav-item {% if request.resolver_match.url_name == 'subjectEnrollmentList' %}active{% endif %}">
      <a class="nav-link" href="{% url 'subjectEnrollmentList' %}">
        <i class="bx bx-user-plus"></i>
        <span>Enroll Student</span>
      </a>
    </li>
  {% endif %}

  <!-- Settings Section -->
  <li class="nav-item">
    {% if not user.profile.role.name|lower == 'student' %}
    <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
      <i class="bx bx-cog"></i>
      <span>Settings</span>
    </a>
    <div id="collapseOne" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionSidebar">
      <div class="bg-white py-2 collapse-inner rounded">
        {% if user|has_perm:'roles.view_role' %}
          <a class="collapse-item" href="{% url 'roleList' %}">
            <i class="bx bx-user-check"></i>
            <span>Role</span>
          </a>
        {% endif %}
        {% if user.is_superuser %}
          <a class="collapse-item" href="{% url 'activityTypeList' %}">
            <i class="bx bx-bar-chart-alt-2"></i>
            <span>Activity Type</span>
          </a>
        {% endif %}
        {% if user|has_perm:'course.view_semester' and user.profile.role.name|lower != 'admin'%}
          <a class="collapse-item" href="{% url 'semesterList' %}">
            <i class="bx bx-clipboard"></i>
            <span>Semester</span>
          </a>
        {% endif %}
        {% if user|has_perm:'subject.view_subject' and user.profile.role.name|lower != 'admin' and user.profile.role.name|lower != 'registrar' %}
          <a class="collapse-item" href="{% url 'viewGradeBookComponents' %}">
            <i class="bx bx-chart"></i>
            <span>Subject Percentage</span>
          </a>
        {% endif %}
        {% if user|has_perm:'subject.view_subject' and user.profile.role.name|lower != 'admin' and user.profile.role.name|lower != 'registrar' %}
          <a class="collapse-item" href="{% url 'subGradebook' %}">
            <i class="bx bx-chart"></i>
            <span>Subject Sub Percentage</span>
          </a>
        {% endif %}
        {% if user|has_perm:'course.view_term' and user.profile.role.name|lower != 'admin' %}
          <a class="collapse-item" href="{% url 'termList' %}">
            <i class="bx bx-calendar-event"></i>
            <span>Term</span>
          </a>
        {% endif %}
        {% if user|has_perm:'subject.view_subject' and  user.profile.role.name|lower != 'admin' and user.profile.role.name|lower != 'registrar' %}
          <a class="collapse-item" href="{% url 'termBookList' %}">
            <i class="bx bx-chart"></i>
            <span>Term Percentage</span>
          </a>
        {% endif %}
        {% if user|has_perm:'course.view_semester' %}
          <a class="collapse-item" href="{% url 'student' %}">
            <i class="bx bx-group"></i>
            <span>Student List</span>
          </a>
        {% endif %}
        {% if user|has_perm:'course.view_semester' %}
          <a class="collapse-item" href="{% url 'staff_list' %}">
            <i class="bx bx-user"></i>
            <span>Staff List</span>
          </a>
        {% endif %}
      </div>
    </div>
    {% endif %}
  </li>

  <!-- Footer -->
  <div class="sidebar-footer mt-auto text-center">
    <hr class="sidebar-divider" />
    <p style="color: #FCEE54; font-size: 15px; font-weight: 900;">EXCELS AS ONE</p>
  </div>
</ul>
