{% extends 'base.html' %}

{% block title %}
  Edit Activity
{% endblock %}

{% block content %}
  <div class="content-wrapper">
    <!-- Content Header -->
    <div class="content-header">
      <div class="container-fluid">
        <h1 class="h3 mb-4 text-gray-800">Edit Activity: {{ activity.activity_name }}</h1>
      </div>
    </div>

    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
        <!-- Activity Edit Form Card -->
        <div class="card shadow mb-4">
          <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">Edit Activity Details</h6>
          </div>
          <div class="card-body">
            <form method="post">
              {% csrf_token %}
              <input type="hidden" name="subject" value="{{ activity.subject.id }}">

              <!-- First Row: Activity Name, Activity Type, Term -->
              <div class="row">
                <div class="col-md-4">
                  <div class="form-group">
                    <label for="activity_name">Activity Name:</label>
                    <input type="text" id="activity_name" name="activity_name" value="{{ form.activity_name.value }}" class="form-control" required />
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-group">
                    <label for="activity_type">Activity Type:</label>
                    {{ form.activity_type }}
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-group">
                    <label for="term">Term:</label>
                    {{ form.term }}
                  </div>
                </div>
              </div>

              <!-- Second Row: Module Selection, Max Retakes, Retake Method -->
              <div class="row">
                <div class="col-md-4">
                  <div class="form-group">
                    <label for="module">Select Module:</label>
                    <select id="module" name="module" class="form-control" required>
                      {% for module in modules %}
                        <option value="{{ module.id }}" {% if module.id == form.module.value %}selected{% endif %}>{{ module.file_name }}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-group">
                    <label for="max_retake">Max Retakes:</label>
                    <input type="number" id="max_retake" name="max_retake" class="form-control" value="0" min="0" required />
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-group">
                    <label for="retake_method">Retake Method:</label>
                    <select id="retake_method" name="retake_method" class="form-control" required>
                      <option value="highest">Highest Score</option>
                      <option value="lowest">Lowest Score</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- Third Row: Start Time, End Time -->
              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="start_time">Start Time:</label>
                    <input type="datetime-local" id="start_time" name="start_time" value="{{ form.start_time.value|date:'Y-m-d\\TH:i' }}" class="form-control" required />
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="form-group">
                    <label for="end_time">End Time:</label>
                    <input type="datetime-local" id="end_time" name="end_time" value="{{ form.end_time.value|date:'Y-m-d\\TH:i' }}" class="form-control" required />
                  </div>
                </div>
              </div>

              <!-- Remedial Activity -->
              <div class="form-check mb-3">
                <input type="checkbox" id="remedial" name="remedial" class="form-check-input" {% if form.remedial.value %}checked{% endif %} />
                <label for="remedial" class="form-check-label">Remedial Activity</label>
              </div>

              <!-- Remedial Students Selection -->
              <div class="form-group" id="remedial_students_field" style="display: none;">
                <label for="remedial_students">Select Students:</label>
                <select id="remedial_students" name="remedial_students" class="form-control" multiple>
                  {% for student in students %}
                    <option value="{{ student.id }}" {% if student.id in form.remedial_students.value %}selected{% endif %}>{{ student.get_full_name }}</option>
                  {% endfor %}
                </select>
              </div>

              <!-- Buttons -->
              <button type="submit" class="btn btn-primary">Save Changes</button>
              <a href="javascript:history.back()" class="btn btn-secondary">Back</a>
            </form>
          </div>
        </div>
        <!-- End of card -->
      </div>
    </section>
  </div>

  <!-- Script for showing/hiding remedial students selection -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var remedialCheckbox = document.getElementById('remedial');
      var remedialStudentField = document.getElementById('remedial_students_field');

      // Show or hide remedial students field based on checkbox state
      function toggleRemedialStudents() {
        if (remedialCheckbox.checked) {
          remedialStudentField.style.display = 'block';
        } else {
          remedialStudentField.style.display = 'none';
        }
      }

      // Call the function on page load
      toggleRemedialStudents();

      // Add event listener to the checkbox to toggle visibility dynamically
      remedialCheckbox.addEventListener('change', toggleRemedialStudents);
    });
  </script>
{% endblock %}
