{% extends 'base.html' %}

{% block title %}
    Registration List
{% endblock %}

{% block content %}
<div class="container">
    <h1>Registration List</h1>
    <div id="registrationDataContainer">Loading registration data...</div>
    <p id="no-registrations" style="display: none;">No registrations found.</p>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetch('{% url "list_registration_ids" %}')
            .then(response => response.json())
            .then(data => {
                const registrationDataContainer = document.getElementById('registrationDataContainer');
                const noRegistrations = document.getElementById('no-registrations');

                if (data.status === 'success' && data.data.length > 0) {
                    let tableRows = data.data.map(item => `
                        <tr>
                            <td>${item.learner_name}</td>
                            <td>${item.course_title}</td>
                            <td>${new Date(item.first_access_date).toLocaleString()}</td>
                            <td>${new Date(item.last_access_date).toLocaleString()}</td>
                            <td>${item.completed_date !== 'N/A' ? new Date(item.completed_date).toLocaleString() : 'N/A'}</td>
                            <td>${item.completion_status}</td>
                        </tr>
                    `).join('');

                    registrationDataContainer.innerHTML = `
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Learner Name</th>
                                    <th>Course Title</th>
                                    <th>First Access Date</th>
                                    <th>Last Access Date</th>
                                    <th>Completed Date</th>
                                    <th>Completion Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${tableRows}
                            </tbody>
                        </table>
                    `;
                } else {
                    noRegistrations.style.display = 'block';
                }
            })
            .catch(error => {
                console.error('Error fetching registration data:', error);
                alert('Failed to load registration data. Please try again later.');
            });
    });
</script>
{% endblock %}
