{% block content %}
  <div id="customRoleModal" class="custom-modal">
    <div class="custom-modal-header">
      <button class="close-btn" id="closeRoleModal"></button>
      <h5>Add Role</h5>
    </div>
    <div class="custom-modal-body">
      <form method="POST" action="{% url 'createTermGradeBookComponent' %}">createRole
        {% csrf_token %}
        <div class="form-group">
          <label for="role">Role:</label>
          {{ form.name }}
        </div>

        <div class="form-group">
          <label for="permissions">Permissions:</label>
          <div>
            <input type="checkbox" id="checkAll"> Check All
          </div>
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>Module</th>
                <th>Add</th>
                <th>View</th>
                <th>Update</th>
                <th>Delete</th>
              </tr>
            </thead>
            <tbody>
              {% for module, actions in structured_permissions.items %}
                <tr>
                  <td>{{ module|capfirst }}</td>
                  <td>
                    {% if actions.add %}
                      <input type="checkbox" name="permissions" class="permission-checkbox" value="{{ actions.add.id }}"
                      {% if actions.add in form.instance.permissions.all %}checked{% endif %}>
                      {{ actions.add.name }}
                    {% endif %}
                  </td>
                  <td>
                    {% if actions.view %}
                      <input type="checkbox" name="permissions" class="permission-checkbox" value="{{ actions.view.id }}"
                      {% if actions.view in form.instance.permissions.all %}checked{% endif %}>
                      {{ actions.view.name }}
                    {% endif %}
                  </td>
                  <td>
                    {% if actions.change %}
                      <input type="checkbox" name="permissions" class="permission-checkbox" value="{{ actions.change.id }}"
                      {% if actions.change in form.instance.permissions.all %}checked{% endif %}>
                      {{ actions.change.name }}
                    {% endif %}
                  </td>
                  <td>
                    {% if actions.delete %}
                      <input type="checkbox" name="permissions" class="permission-checkbox" value="{{ actions.delete.id }}"
                      {% if actions.delete in form.instance.permissions.all %}checked{% endif %}>
                      {{ actions.delete.name }}
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <button type="submit" class="btn btn-primary">Save</button>
      </form>
    </div>
  </div>

  <!-- Custom Modal Backdrop -->
  <div id="customRoleModalBackdrop" class="custom-modal-backdrop"></div>

  <!-- Add this script for "Check All" functionality -->
  <script>
    document.getElementById('checkAll').addEventListener('change', function() {
        let checkboxes = document.querySelectorAll('.permission-checkbox');
        for (let checkbox of checkboxes) {
            checkbox.checked = this.checked;
        }
    });
  </script>
{% endblock %}
